/** Trumbowyg v2.1.2 - A lightweight WYSIWYG editor - alex-d.github.io/Trumbowyg - License MIT - Author : Alexandre Demode (Alex-D) / alex-d.fr */
jQuery.trumbowyg={langs:{en:{viewHTML:"View HTML",undo:"Undo",redo:"Redo",formatting:"Formatting",p:"Paragraph",blockquote:"Quote",code:"Code",header:"Header",bold:"Bold",italic:"Italic",strikethrough:"Stroke",underline:"Underline",strong:"Strong",em:"Emphasis",del:"Deleted",superscript:"Superscript",subscript:"Subscript",unorderedList:"Unordered list",orderedList:"Ordered list",insertImage:"Insert Image",link:"Link",createLink:"Insert link",unlink:"Remove link",justifyLeft:"Align Left",justifyCenter:"Align Center",justifyRight:"Align Right",justifyFull:"Align Justify",horizontalRule:"Insert horizontal rule",removeformat:"Remove format",fullscreen:"Fullscreen",close:"Close",submit:"Confirm",reset:"Cancel",required:"Required",description:"Description",title:"Title",text:"Text",target:"Target"}},plugins:{},svgPath:null},function(i,d,c,u){"use strict";u.fn.trumbowyg=function(e,t){var n="trumbowyg";if(e===Object(e)||!e)return this.each(function(){u(this).data(n)||u(this).data(n,new o(this,e))});if(1===this.length)try{var a=u(this).data(n);switch(e){case"execCmd":return a.execCmd(t.cmd,t.param,t.forceCss);case"openModal":return a.openModal(t.title,t.content);case"closeModal":return a.closeModal();case"openModalInsert":return a.openModalInsert(t.title,t.fields,t.callback);case"saveRange":return a.saveRange();case"getRange":return a.range;case"getRangeText":return a.getRangeText();case"restoreRange":return a.restoreRange();case"enable":return a.toggleDisable(!1);case"disable":return a.toggleDisable(!0);case"destroy":return a.destroy();case"empty":return a.empty();case"html":return a.html(t)}}catch(e){}return!1};var o=function(e,t){var a=this,n="trumbowyg-icons",o=(a.doc=e.ownerDocument||c,a.$ta=u(e),a.$c=u(e),null!=(t=t||{}).lang||null!=u.trumbowyg.langs[t.lang]?a.lang=u.extend(!0,{},u.trumbowyg.langs.en,u.trumbowyg.langs[t.lang]):a.lang=u.trumbowyg.langs.en,(null!=u.trumbowyg.svgPath?u.trumbowyg:t).svgPath);if(a.hasSvg=!1!==o,a.svgPath=a.doc.querySelector("base")?d.location.href.split("#")[0]:"",0===u("#"+n,a.doc).length&&!1!==o){if(null==o)try{throw new Error}catch(e){var i,r=e.stack.split("\n");for(i in r)if(r[i].match(/http[s]?:\/\//)){(o=r[Number(i)].match(/((http[s]?:\/\/.+\/)([^\/]+\.js))(\?.*)?:/)[1].split("/")).pop(),o=o.join("/")+"/ui/icons.svg";break}}var s=a.doc.createElement("div");s.id=n,a.doc.body.insertBefore(s,a.doc.body.childNodes[0]),u.ajax({async:!0,type:"GET",contentType:"image/svg",dataType:"xml",url:o,data:null,beforeSend:null,complete:null,success:function(e){s.innerHTML=(new XMLSerializer).serializeToString(e.documentElement)}})}function l(){return(d.chrome||d.Intl&&Intl.v8BreakIterator)&&"CSS"in d}n=a.lang.header;a.btnsDef={viewHTML:{fn:"toggle"},undo:{isSupported:l,key:"Z"},redo:{isSupported:l,key:"Y"},p:{fn:"formatBlock"},blockquote:{fn:"formatBlock"},h1:{fn:"formatBlock",title:n+" 1"},h2:{fn:"formatBlock",title:n+" 2"},h3:{fn:"formatBlock",title:n+" 3"},h4:{fn:"formatBlock",title:n+" 4"},subscript:{tag:"sub"},superscript:{tag:"sup"},bold:{key:"B"},italic:{key:"I"},underline:{tag:"u"},strikethrough:{tag:"strike"},strong:{fn:"bold",key:"B"},em:{fn:"italic",key:"I"},del:{fn:"strikethrough"},createLink:{key:"K",tag:"a"},unlink:{},insertImage:{},justifyLeft:{tag:"left",forceCss:!0},justifyCenter:{tag:"center",forceCss:!0},justifyRight:{tag:"right",forceCss:!0},justifyFull:{tag:"justify",forceCss:!0},unorderedList:{fn:"insertUnorderedList",tag:"ul"},orderedList:{fn:"insertOrderedList",tag:"ol"},horizontalRule:{fn:"insertHorizontalRule"},removeformat:{fn:"removeformat"},fullscreen:{class:"trumbowyg-not-disable"},close:{fn:"destroy",class:"trumbowyg-not-disable"},formatting:{dropdown:["p","blockquote","h1","h2","h3","h4"],ico:"p"},link:{dropdown:["createLink","unlink"]}},a.o=u.extend(!0,{},{lang:"en",fixedBtnPane:!1,fixedFullWidth:!1,autogrow:!1,prefix:"trumbowyg-",semantic:!0,resetCss:!1,removeformatPasted:!1,tagsToRemove:[],btnsGrps:{design:["bold","italic","underline","strikethrough"],semantic:["strong","em","del"],justify:["justifyLeft","justifyCenter","justifyRight","justifyFull"],lists:["unorderedList","orderedList"]},btns:[["viewHTML"],["undo","redo"],["formatting"],"btnGrp-semantic",["superscript","subscript"],["link"],["insertImage"],"btnGrp-justify","btnGrp-lists",["horizontalRule"],["removeformat"],["fullscreen"]],btnsDef:{},inlineElementsSelector:"a,abbr,acronym,b,caption,cite,code,col,dfn,dir,dt,dd,em,font,hr,i,kbd,li,q,span,strikeout,strong,sub,sup,u",pasteHandlers:[],imgDblClickHandler:function(){var t=u(this),e=t.attr("src"),n="(Base64)";return 0===e.indexOf("data:image")&&(e=n),a.openModalInsert(a.lang.insertImage,{url:{label:"URL",value:e,required:!0},alt:{label:a.lang.description,value:t.attr("alt")},width:{label:a.lang.width,type:"number",value:t.attr("width")},padding:{label:a.lang.padding,value:t.css("padding")},align:{label:a.lang.align,html:a.buildImageAlignField(a,t.attr("align")),value:t.attr("align")},usePreview:{label:a.lang.usePreview,type:"checkbox",checked:t.is("[data-preview]")}},function(e){return e.src!==n&&t.attr({src:e.src}),"none"==e.align&&(e.padding="0"),"left"!=e.align||"0px 0px 10px 10px"!=e.padding&&"0px"!=e.padding&&"0"!=e.padding&&""!=e.padding||(e.padding="0px 10px 10px 0px"),"right"!=e.align||"0px 10px 10px 0px"!=e.padding&&"0px"!=e.padding&&"0"!=e.padding&&""!=e.padding||(e.padding="0px 0px 10px 10px"),t.removeAttr("data-preview"),e.usePreview&&t.attr("data-preview",e.usePreview),t.attr({alt:e.alt,width:e.width,align:e.align}).css("padding",e.padding),!0}),!1},plugins:{}},t),a.disabled=a.o.disabled||"TEXTAREA"===e.nodeName&&e.disabled,t.btns?a.o.btns=t.btns:a.o.semantic||(a.o.btns[4]="btnGrp-design"),u.each(a.o.btnsDef,function(e,t){a.addBtnDef(e,t)}),a.keys=[],a.tagToButton={},a.tagHandlers=[],a.pasteHandlers=[].concat(a.o.pasteHandlers),a.init()};o.prototype={init:function(){var e=this;e.height=e.$ta.height(),e.initPlugins();try{e.doc.execCommand("enableObjectResizing",!1,!1)}catch(e){}e.doc.execCommand("defaultParagraphSeparator",!1,"p"),e.buildEditor(),e.buildBtnPane(),e.fixedBtnPaneEvents(),e.buildOverlay(),setTimeout(function(){e.disabled&&e.toggleDisable(!0),e.$c.trigger("tbwinit")})},addBtnDef:function(e,t){this.btnsDef[e]=t},buildEditor:function(){var e,a=this,t=a.o.prefix,n="",o=(a.$box=u("<div/>",{class:t+"box "+t+"editor-visible "+t+a.o.lang+" trumbowyg"}),a.isTextarea=a.$ta.is("textarea"),a.isTextarea?(n=a.$ta.val(),a.$ed=u("<div/>"),a.$box.insertAfter(a.$ta).append(a.$ed,a.$ta)):(a.$ed=a.$ta,n=a.$ed.html(),a.$ta=u("<textarea/>",{name:a.$ta.attr("id"),height:a.height}).val(n),a.$box.insertAfter(a.$ed).append(a.$ta,a.$ed),a.syncCode()),a.$ta.addClass(t+"textarea").attr("tabindex",-1),a.$ed.addClass(t+"editor").attr({contenteditable:!0,dir:a.lang._dir||"ltr"}).html(n),a.o.tabindex&&a.$ed.attr("tabindex",a.o.tabindex),a.$c.is("[placeholder]")&&a.$ed.attr("placeholder",a.$c.attr("placeholder")),a.o.resetCss&&a.$ed.addClass(t+"reset-css"),a.o.autogrow||a.$ta.add(a.$ed).css({height:a.height}),a.semanticCode(),!1);a.$ed.on("dblclick","img",a.o.imgDblClickHandler).on("keydown",function(e){if(e.ctrlKey){o=!0;e=a.keys[String.fromCharCode(e.which).toUpperCase()];try{return a.execCmd(e.fn,e.param),!1}catch(e){}}}).on("keyup input",function(e){37<=e.which&&e.which<=40||(!e.ctrlKey||89!==e.which&&90!==e.which?o||17===e.which||(a.semanticCode(!1,13===e.which),a.$c.trigger("tbwchange")):a.$c.trigger("tbwchange"),setTimeout(function(){o=!1},200))}).on("mouseup keydown keyup",function(){clearTimeout(e),e=setTimeout(function(){a.updateButtonPaneStatus()},50)}).on("focus blur",function(e){a.$c.trigger("tbw"+e.type),"blur"===e.type&&u("."+t+"active-button",a.$btnPane).removeClass(t+"active-button "+t+"active")}).on("cut",function(){a.semanticCode(!1,!0),a.$c.trigger("tbwchange")}).on("paste",function(n){if(a.o.removeformatPasted){n.preventDefault();try{var t=d.clipboardData.getData("Text");try{a.doc.selection.createRange().pasteHTML(t)}catch(e){a.doc.getSelection().getRangeAt(0).insertNode(a.doc.createTextNode(t))}}catch(e){a.execCmd("insertText",(n.originalEvent||n).clipboardData.getData("text/plain"))}}u.each(a.pasteHandlers,function(e,t){t(n)}),setTimeout(function(){a.semanticCode(!1,!0),a.$c.trigger("tbwpaste",n)},0)}),a.$ta.on("keyup paste",function(){a.$c.trigger("tbwchange")}),u(a.doc).on("keydown",function(e){if(27===e.which)return a.closeModal(),!1})},buildBtnPane:function(){var o=this,i=o.o.prefix,r=o.$btnPane=u("<div/>",{class:i+"button-pane"});u.each(o.o.btns,function(e,t){try{var n=t.split("btnGrp-");null!=n[1]&&(t=o.o.btnsGrps[n[1]])}catch(e){}u.isArray(t)||(t=[t]);var a=u("<div/>",{class:i+"button-group "+(0<=t.indexOf("fullscreen")?i+"right":"")});u.each(t,function(e,t){try{var n;o.isSupportedBtn(t)&&(n=o.buildBtn(t)),a.append(n)}catch(e){}}),r.append(a)}),o.$box.prepend(r)},buildBtn:function(e){var t,n,a=this,o=a.o.prefix,i=a.btnsDef[e],r=i.dropdown,s=a.lang[e]||e,s=u("<button/>",{type:"button",class:o+e+"-button "+(i.class||""),html:a.hasSvg?'<svg><use xlink:href="'+a.svgPath+"#"+o+(i.ico||e).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>':"",title:(i.title||i.text||s)+(i.key?" (Ctrl + "+i.key+")":""),tabindex:-1,mousedown:function(){return r&&!u("."+e+"-"+o+"dropdown",a.$box).is(":hidden")||u("body",a.doc).trigger("mousedown"),a.$btnPane.hasClass(o+"disable")&&!u(this).hasClass(o+"active")&&!u(this).hasClass(o+"not-disable")||a.execCmd((!r?i.fn:"dropdown")||e,i.param||e,i.forceCss||!1),!1}});return r?(s.addClass(o+"open-dropdown"),n=u("<div/>",{class:(t=o+"dropdown")+"-"+e+" "+t+" "+o+"fixed-top","data-dropdown":e}),u.each(r,function(e,t){a.btnsDef[t]&&a.isSupportedBtn(t)&&n.append(a.buildSubBtn(t))}),a.$box.append(n.hide())):i.key&&(a.keys[i.key]={fn:i.fn||e,param:i.param||e}),r||(a.tagToButton[(i.tag||e).toLowerCase()]=e),s},buildSubBtn:function(e){var t=this,n=t.o.prefix,a=t.btnsDef[e];return a.key&&(t.keys[a.key]={fn:a.fn||e,param:a.param||e}),t.tagToButton[(a.tag||e).toLowerCase()]=e,u("<button/>",{type:"button",class:n+e+"-dropdown-button"+(a.ico?" "+n+a.ico+"-button":""),html:t.hasSvg?'<svg><use xlink:href="'+t.svgPath+"#"+n+(a.ico||e).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>'+(a.text||a.title||t.lang[e]||e):"",title:a.key?" (Ctrl + "+a.key+")":null,style:a.style||null,mousedown:function(){return u("body",t.doc).trigger("mousedown"),t.execCmd(a.fn||e,a.param||e,a.forceCss||!1),!1}})},isSupportedBtn:function(e){try{return this.btnsDef[e].isSupported()}catch(e){}return!0},buildOverlay:function(){var e=this;return e.$overlay=u("<div/>",{class:e.o.prefix+"overlay"}).css({top:e.$btnPane.outerHeight(),height:e.$ed.outerHeight()+1+"px"}).appendTo(e.$box),e.$overlay},showOverlay:function(){u(d).trigger("scroll"),this.$overlay.fadeIn(200),this.$box.addClass(this.o.prefix+"box-blur")},hideOverlay:function(){this.$overlay.fadeOut(50),this.$box.removeClass(this.o.prefix+"box-blur")},fixedBtnPaneEvents:function(){var o=this,i=o.o.fixedFullWidth,r=o.$box;o.o.fixedBtnPane&&(o.isFixed=!1,u(d).on("scroll resize",function(){var e,t,n,a;r&&(o.syncCode(),e=u(d).scrollTop(),t=r.offset().top+1,a=(n=o.$btnPane).outerHeight()-2,0<e-t&&e-t-o.height<0?(o.isFixed||(o.isFixed=!0,n.css({position:"fixed",top:0,left:i?"0":"auto",zIndex:7}),u([o.$ta,o.$ed]).css({marginTop:n.height()})),n.css({width:i?"100%":r.width()-1+"px"}),u("."+o.o.prefix+"fixed-top",r).css({position:i?"fixed":"absolute",top:i?a:e-t+a+"px",zIndex:15})):o.isFixed&&(o.isFixed=!1,n.removeAttr("style"),u([o.$ta,o.$ed]).css({marginTop:0}),u("."+o.o.prefix+"fixed-top",r).css({position:"absolute",top:a})))}))},toggleDisable:function(e){var t=this,n=t.o.prefix;(t.disabled=e)?t.$ta.attr("disabled",!0):t.$ta.removeAttr("disabled"),t.$box.toggleClass(n+"disabled",e),t.$ed.attr("contenteditable",!e)},destroy:function(){var e=this,t=e.o.prefix,n=e.height;e.isTextarea?e.$box.after(e.$ta.css({height:n}).val(e.html()).removeClass(t+"textarea").show()):e.$box.after(e.$ed.css({height:n}).removeClass(t+"editor").removeAttr("contenteditable").html(e.html()).show()),e.$ed.off("dblclick","img"),e.destroyPlugins(),e.$box.remove(),e.$c.removeData("trumbowyg"),u("body").removeClass(t+"body-fullscreen"),e.$c.trigger("tbwclose")},empty:function(){this.$ta.val(""),this.syncCode(!0)},removeformat:function(){var e=this.doc.getSelection().focusNode;this.saveRange(),u(e).hasClass("trumbowyg-editor")||(e.removeAttribute("style"),e.removeAttribute("class"),e.removeAttribute("size"),e.removeAttribute("face")),e.childNodes&&0<e.childNodes.length&&e.childNodes.forEach(function(e){console.log("selected",this),this.removeAttribute("style"),this.removeAttribute("class"),this.removeAttribute("size"),this.removeAttribute("face")}),this.$c.trigger("tbwchange")},toggle:function(){var e=this,t=e.o.prefix;e.semanticCode(!1,!0),setTimeout(function(){e.doc.activeElement.blur(),e.$box.toggleClass(t+"editor-hidden "+t+"editor-visible"),e.$btnPane.toggleClass(t+"disable"),u("."+t+"viewHTML-button",e.$btnPane).toggleClass(t+"active"),e.$box.hasClass(t+"editor-visible")?e.$ta.attr("tabindex",-1):e.$ta.removeAttr("tabindex")},0)},dropdown:function(e){var t=this,n=t.doc,a=t.o.prefix,o=u("[data-dropdown="+e+"]",t.$box),e=u("."+a+e+"-button",t.$btnPane),i=o.is(":hidden");u("body",n).trigger("mousedown"),i&&(i=e.offset().left,e.addClass(a+"active"),o.css({position:"absolute",top:e.offset().top-t.$btnPane.offset().top+e.outerHeight(),left:t.o.fixedFullWidth&&t.isFixed?i+"px":i-t.$btnPane.offset().left+"px"}).show(),u(d).trigger("scroll"),u("body",n).on("mousedown",function(){u("."+a+"dropdown",n).hide(),u("."+a+"active",n).removeClass(a+"active"),u("body",n).off("mousedown")}))},html:function(e){return null!=e?(this.$ta.val(e),this.syncCode(!0),this):this.$ta.val()},syncTextarea:function(){this.$ta.val(0<this.$ed.text().trim().length||0<this.$ed.find("hr,img,embed,iframe,input").length?this.$ed.html():"")},syncCode:function(e){var t=this;!e&&t.$ed.is(":visible")?t.syncTextarea():t.$ed.html(t.$ta.val()),t.o.autogrow&&(t.height=t.$ed.height(),t.height!==t.$ta.css("height")&&(t.$ta.css({height:t.height}),t.$c.trigger("tbwresize")))},semanticCode:function(e,t){var n,a,o,i=this;i.saveRange(),i.syncCode(e),u(i.o.tagsToRemove.join(","),i.$ed).remove(),i.o.semantic&&(i.semanticTag("b","strong"),i.semanticTag("i","em"),t&&(n=i.o.inlineElementsSelector,a=":not("+n+")",i.$ed.contents().filter(function(){return 3===this.nodeType&&0<this.nodeValue.trim().length}).wrap("<span data-tbw/>"),(o=function(e){var t;0!==e.length&&(t=(e=e.nextUntil(a).addBack().wrapAll("<p/>").parent()).nextAll(n).first(),e.next("br").remove(),o(t))})(i.$ed.children(n).first()),i.semanticTag("div","p",!0),i.$ed.find("p").filter(function(){return(!i.range||this!==i.range.startContainer)&&(0===u(this).text().trim().length&&0===u(this).children().not("br,span").length)}).contents().unwrap(),u("[data-tbw]",i.$ed).contents().unwrap(),i.$ed.find("p:empty").remove()),i.restoreRange(),i.syncTextarea())},semanticTag:function(e,t,n){u(e,this.$ed).each(function(){var e=u(this);e.wrap("<"+t+"/>"),n&&u.each(e.prop("attributes"),function(){e.parent().attr(this.name,this.value)}),e.contents().unwrap()})},createLink:function(){var e,t,n,a,o=this,i=o.doc.getSelection(),r=i.focusNode,s=!1,l=[];for(r&&r.childNodes&&0<r.childNodes.length&&r.childNodes.forEach(function(e){"IMG"==e.nodeName&&(s=!0),l.push(e.outerHTML)});["A","DIV"].indexOf(r.nodeName)<0;)r=r.parentNode;r&&"A"===r.nodeName&&(e=(n=u(r)).attr("href"),t=n.attr("title"),n=n.attr("target"),(a=o.doc.createRange()).selectNode(r),i.addRange(a)),o.saveRange(),o.openModalInsert(o.lang.createLink,{url:{label:"URL",required:!0,value:e},title:{label:o.lang.title,value:t},text:{label:o.lang.text,value:o.getRangeText()},target:{label:o.lang.target,value:n||"_blank"}},function(e){var t=['<a href="',e.url,'">'];return s?t.push(l.join("")):t.push(e.text),t.push("</a>"),t=u(t.join("")),0<e.title.length&&t.attr("title",e.title),0<e.target.length&&t.attr("target",e.target),o.range.deleteContents(),o.range.insertNode(t[0]),!0})},unlink:function(){var e,t=this.doc.getSelection(),n=t.focusNode;if(t.isCollapsed){for(;["A","DIV"].indexOf(n.nodeName)<0;)n=n.parentNode;n&&"A"===n.nodeName&&((e=this.doc.createRange()).selectNode(n),t.addRange(e))}this.execCmd("unlink",void 0,void 0,!0)},insertImage:function(){var t=this;t.saveRange(),t.openModalInsert(t.lang.insertImage,{url:{label:"URL",required:!0},alt:{label:t.lang.description,value:t.getRangeText()}},function(e){return t.execCmd("insertImage",e.url),u('img[src="'+e.url+'"]:not([alt])',t.$box).attr("alt",e.alt),!0})},fullscreen:function(){var e=this.o.prefix,t=e+"fullscreen";this.$box.toggleClass(t),t=this.$box.hasClass(t),u("body").toggleClass(e+"body-fullscreen",t),u(d).trigger("scroll"),this.$c.trigger("tbw"+(t?"open":"close")+"fullscreen")},execCmd:function(t,n,e,a){var o=this;a=!!a||"","dropdown"!==t&&o.$ed.focus(),o.doc.execCommand("styleWithCSS",!1,e||!1);try{o[t+a](n)}catch(e){try{t(n)}catch(e){"insertHorizontalRule"===t?n=void 0:"formatBlock"!==t||-1===i.userAgent.indexOf("MSIE")&&-1===i.appVersion.indexOf("Trident/")||(n="<"+n+">"),o.doc.execCommand(t,!1,n),o.syncCode(),o.semanticCode(!1,!0)}"dropdown"!==t&&(o.updateButtonPaneStatus(),o.$c.trigger("tbwchange"))}},openModal:function(e,t){var n=this,a=n.o.prefix;if(0<u("."+a+"modal-box",n.$box).length)return!1;n.saveRange(),n.showOverlay(),n.$btnPane.addClass(a+"disable");var o=u("<div/>",{class:a+"modal "+a+"fixed-top"}).css({top:n.$btnPane.height()}).appendTo(n.$box),t=(n.$overlay.one("click",function(){return o.trigger("tbwcancel"),!1}),u("<form/>",{action:"",html:t}).on("submit",function(){return o.trigger("tbwconfirm"),!1}).on("reset",function(){return o.trigger("tbwcancel"),!1})),t=u("<div/>",{class:a+"modal-box",html:t}).css({top:"-"+n.$btnPane.outerHeight()+"px",opacity:0}).appendTo(o).animate({top:0,opacity:1},100);return u("<span/>",{text:e,class:a+"modal-title"}).prependTo(t),o.height(t.outerHeight()+10),u("input:first",t).focus(),n.buildModalBtn("submit",t),n.buildModalBtn("reset",t),u(d).trigger("scroll"),o},buildModalBtn:function(e,t){var n=this.o.prefix;return u("<button/>",{class:n+"modal-button "+n+"modal-"+e,type:e,text:this.lang[e]||e}).appendTo(u("form",t))},closeModal:function(){var e=this,t=e.o.prefix,n=(e.$btnPane.removeClass(t+"disable"),e.$overlay.off(),u("."+t+"modal-box",e.$box));n.animate({top:"-"+n.height()},100,function(){n.parent().remove(),e.hideOverlay()}),e.restoreRange()},buildImageAlignField:function(e,t){t=t||"none";var n=[];return n.push('<select name="align">'),n.push("<option "+("none"==t?'selected="selected"':"")+' value="none">'+e.lang.alignNone+"</option>"),n.push("<option "+("left"==t?'selected="selected"':"")+' value="left">'+e.lang.alignLeft+"</option>"),n.push("<option "+("right"==t?'selected="selected"':"")+' value="right">'+e.lang.alignRight+"</option>"),n.push("</select>"),n.join("")},openModalInsert:function(e,t,n){var r=this,i=r.o.prefix,s=r.lang,l="",d="tbwconfirm";return u.each(t,function(e,t){var n=t.label,a=t.name||e,o=t.checked?' checked="checked"':"";t.html=t.html||'<input type="'+(t.type||"text")+'"'+o+' name="'+a+'" value="'+(t.value||"").replace(/"/g,"&quot;")+'">',l+="<label>"+t.html+'<span class="'+i+'input-infos"><span>'+(n?s[n]||n:s[e]||e)+"</span></span></label>"}),r.openModal(e,l).on(d,function(){var a=u("form",u(this)),o=!0,i={};u.each(t,function(e,t){var n=u('[name="'+e+'"]',a);i[e]="checkbox"===t.type?n.is(":checked"):u.trim(n.val()),t.required&&""===i[e]?(o=!1,r.addErrorOnModalField(n,r.lang.required)):t.pattern&&!t.pattern.test(i[e])&&(o=!1,r.addErrorOnModalField(n,t.patternError))}),o&&(r.restoreRange(),n(i,t)&&(r.syncCode(),r.$c.trigger("tbwchange"),r.closeModal(),u(this).off(d)))}).one("tbwcancel",function(){u(this).off(d),r.closeModal()})},addErrorOnModalField:function(e,t){var n=this.o.prefix,a=e.parent();e.on("change keyup",function(){a.removeClass(n+"input-error")}),a.addClass(n+"input-error").find("input+span").append(u("<span/>",{class:n+"msg-error",text:t}))},saveRange:function(){var e,t=this,n=t.doc.getSelection();t.range=null,n.rangeCount&&(n=t.range=n.getRangeAt(0),(e=t.doc.createRange()).selectNodeContents(t.$ed[0]),e.setEnd(n.startContainer,n.startOffset),t.metaRange={start:t=(e+"").length,end:t+(n+"").length})},restoreRange:function(){var e=this,t=e.metaRange,n=e.range,a=e.doc.getSelection();if(n){if(t&&t.start!==t.end)for(var o,i=0,r=[e.$ed[0]],s=!1,l=!1,d=e.doc.createRange();!l&&(o=r.pop());)if(3===o.nodeType){var c=i+o.length;!s&&t.start>=i&&t.start<=c&&(d.setStart(o,t.start-i),s=!0),s&&t.end>=i&&t.end<=c&&(d.setEnd(o,t.end-i),l=!0),i=c}else for(var u=o.childNodes,g=u.length;0<g;)r.push(u[--g]);a.removeAllRanges(),a.addRange(d||n)}},getRangeText:function(){return this.range+""},updateButtonPaneStatus:function(){var o=this,i=o.o.prefix,e=o.getTagsRecursive(o.doc.getSelection().focusNode),r=i+"active-button "+i+"active";u("."+i+"active-button",o.$btnPane).removeClass(r),u.each(e,function(e,t){t=o.tagToButton[t.toLowerCase()];if(0<(n=u("."+i+t+"-button",o.$btnPane)).length)n.addClass(r);else try{var n,a=(n=u("."+i+"dropdown ."+i+t+"-dropdown-button",o.$box)).parent().data("dropdown");u("."+i+a+"-button",o.$box).addClass(r)}catch(e){}})},getTagsRecursive:function(n,a){var o=this;if(a=a||[],!n)return a;var e=(n=n.parentNode).tagName;return"DIV"===e?a:("P"===e&&""!==n.style.textAlign&&a.push(n.style.textAlign),u.each(o.tagHandlers,function(e,t){a=a.concat(t(n,o))}),a.push(e),o.getTagsRecursive(n,a))},initPlugins:function(){var n=this;n.loadedPlugins=[],u.each(u.trumbowyg.plugins,function(e,t){t.shouldInit&&!t.shouldInit(n)||(t.init(n),t.tagHandler&&n.tagHandlers.push(t.tagHandler),n.loadedPlugins.push(t))})},destroyPlugins:function(){u.each(this.loadedPlugins,function(e,t){t.destroy&&t.destroy()})}}}(navigator,window,document,jQuery);